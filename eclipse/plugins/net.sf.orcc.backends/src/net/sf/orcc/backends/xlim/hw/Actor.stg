import "net/sf/orcc/backends/xlim/sw/Actor.stg"

///////////////////////////////////////////////////////////////////////////////
// Override XLIM Templates For XLIM Hardware Generation

localInitialize(local) ::= <<
>>

typeDefLocal(local) ::= <<
>>

// Input and output pattern
patternPortPinAvail(dir, port)::= <<
\<!--  <dir>putPattern --\>
<if(port.native)>
\<operation kind="$literal_Integer" value="1"\>
	\<port dir="out" size="1" source="<dir>putPattern_<instance.id>_<action.name>_<port.name>" typeName="bool"/\>
\</operation\>
<else>
\<operation kind="noop"\>
	\<port dir="in" source="<port.name>_pinStatus"/\>
	\<port dir="out" size="1" source="<dir>putPattern_<instance.id>_<action.name>_<port.name>" typeName="bool"/\>
\</operation\>
<endif>
>>


declarePinAvailableVariable(port) ::= <<
<if(!port.native)>
\<operation kind="pinStatus" portName="<port.name>"\>
  \<port dir="out" source="<port.name>_pinStatus" typeName="bool"/\>
\</operation\>
<else>
\<!-- No need for pinStatus for native ports --\>
<endif>
>>

// For the switch structure of Openforge BE

printTransitions(actions, transitionsList) ::= <<
\<!-- All transitions --\>
\<module kind="block" mutex="true"\>
	<transitionsList:{transitions | <printTransition(transitions)>}; separator="\n">
\</module\>
>>

closeHwTransition() ::=<<
\</module\>\</module\>
>>

//Adding FPGA Config type for OpenForge BE


fpgaType() ::=<<
\<config_option id="<instance.id>_fpgaType" name="project.xflow.xilinx_part" value="<options.fpgaType>"/\>
>>

// Adding the fpgaType ST to the design
printDesign(instance) ::= <<
\<!-- /<printHierarchicalPath(instance.hierarchicalId)> --\>
\<!-- Source file is "<instance.actor.file>" --\>
\<design name="<instance.id>"\>
	<actorPorts()>
	<parameters(instance.arguments)>
	<stateVars()>
	<instance.actor.actions: typeDef()>
	<instance.actor.actions: action(); separator="\n">
	<fpgaType()>
	<if(instance.actor.fsm)>
	<schedulerFSM(actions=instance.actor.actionsOutsideFsm, fsm=instance.actor.fsm)>
	<else>
	<scheduler(actions=instance.actor.actionsOutsideFsm)>
	<endif>
\</design\>
>>
