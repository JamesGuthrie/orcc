

printDesign(design, options) ::= <<
-------------------------------------------------------------------------------
-- Title      : Network: <design.name>
-- Project    : 
-------------------------------------------------------------------------------
-- File       : <design.name>.vhd
-- Author     : Orcc - TTA
-- Company    : 
-- Created    : 
-- Standard   : VHDL'93
-------------------------------------------------------------------------------
-- Copyright (c)  
-------------------------------------------------------------------------------
-- Revisions  :
-- Date        Version  Author  Description
-- 
-------------------------------------------------------------------------------


------------------------------------------------------------------------------
library ieee;
use ieee.std_logic_1164.all;

library work;
use work.broadcast_type.all;

------------------------------------------------------------------------------
entity top is
  port
    (
      clk          : in  std_logic;
      <declarePorts(design)>
      rst_n        : in  std_logic
      );
end top;

------------------------------------------------------------------------------
architecture bdf_type of top is

  ---------------------------------------------------------------------------
  -- Signals declaration
  ---------------------------------------------------------------------------  
  <design.signals: declareSignal(); separator="\n">
  ---------------------------------------------------------------------------
  
begin

  ---------------------------------------------------------------------------
  -- Ports instantiation 
  ---------------------------------------------------------------------------
  <design.inputs: { input | <assignNetworkPort(input, false)> }; separator="\n">
  <design.outputs: { output | <assignNetworkPort(output, false)> }; separator="\n">
  ---------------------------------------------------------------------------
  -- FIFOs instantiation 
  --------------------------------------------------------------------------- 
  <design.fifos: assignFifo(); separator="\n\n">
  ---------------------------------------------------------------------------
  -- Processors instantiation 
  ---------------------------------------------------------------------------
  <design.processors: assignProcessor(); separator="\n\n">
---------------------------------------------------------------------------
  -- Components instantiation 
  ---------------------------------------------------------------------------
  <design.components: assignComponent(); separator="\n\n">
  ---------------------------------------------------------------------------  


end bdf_type;

>>

///////////////////////////////////////////////////////////////////////////////
// Network ports
///////////////////////////////////////////////////////////////////////////////

declarePorts(component) ::= <<
<if(design.inputs)><design.inputs: declareInput(); separator="\n"><endif>
<if(design.outputs)><design.outputs: declareOutput(); separator="\n"><endif>
>>

declareInput(port) ::= <<
<port.name> : in std_logic_vector(<port.size> downto 0);
>>

declareOutput(port) ::= <<
<port.name> : out std_logic_vector(<port.size> downto 0);
>>


///////////////////////////////////////////////////////////////////////////////
// Signals
///////////////////////////////////////////////////////////////////////////////

declareBroadcastSignals(broadcast) ::= <<
signal <broadcast.name>_data_outputs   : array_logic_v32(<length(broadcast.outputs)>-1 downto 0);
signal <broadcast.name>_status_outputs : array_logic_v32(<length(broadcast.outputs)>-1 downto 0);
signal <broadcast.name>_dv_outputs     : std_logic_vector(<length(broadcast.outputs)>-1 downto 0);
>>

declareSignal(signal) ::= <<
signal <signal.name> : std_logic_vector(31 downto 0);
>>


///////////////////////////////////////////////////////////////////////////////
// Instantiation
///////////////////////////////////////////////////////////////////////////////

assignNetworkPort(port, signal) ::= <<
<port.name> \<= <signal.name>;
>>

assignPort(port, signal) ::= <<
<port.name> =\> <signal.name>;
>>

assignComponent(component) ::= <<
<component.name> : entity work.<component.entityName>
  generic map()
  port map(clk          =\> clk,
  	       <component.inputs: { input | <assignPort(input, component.incomingPortMap.(input))> }; separator="\n">
           <component.outputs: { output | <assignPort(output, component.outgoingPortMap.(output))> }; separator="\n">
           rst_n        =\> rst_n);
>>

assignFifo(fifo) ::= <<
<fifo.name> : entity work.<fifo.entityName>
  generic map(device_family =\> "<options.fpga.family>")
  port map(clk          =\> clk,
  	       <fifo.inputs: { input | <assignPort(input, fifo.incomingPortMap.(input))> }; separator="\n">
           <fifo.outputs: { output | <assignPort(output, fifo.outgoingPortMap.(output))> }; separator="\n">
           rst_n        =\> rst_n);
>>

assignProcessor(processor) ::= <<
<processor.name> : entity work.<processor.entityName>
  generic map(device_family =\> "<options.fpga.family>")
  port map(clk          =\> clk,
           <processor.inputs: { input | <assignPort(input, processor.incomingPortMap.(input))> }; separator="\n">
           <processor.outputs: { output | <assignPort(output, processor.outgoingPortMap.(output))> }; separator="\n">
           rst_n        =\> rst_n);
>>

assignBroadcast(broadcast) ::= <<
<broadcast.name> : entity work.<broadcast.entityName>
  generic map()
  port map(clk          =\> clk,
           <broadcast.inputs: { input | <assignPort(input, broadcast.incomingPortMap.(input))> }; separator="\n">
           <broadcast.outputs: { output | <assignPort(output, broadcast.outgoingPortMap.(output))> }; separator="\n">
           rst_n        =\> rst_n);
>>

assignGenerics(instance) ::= <<
<instance.arguments: { arg | <arg.variable.name> =\> <arg.value>}; separator=",\n              ">
>>
